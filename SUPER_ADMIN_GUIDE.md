# üî± GUIDE SUPER ADMIN - CR√âATION ET IDENTIFIANTS

## üìã **IDENTIFIANTS SUPER ADMIN ACTUEL**

### **üéØ Compte Super Admin Principal**
```
üë§ Nom:           Fatine
üìß Email:         admin@epg.ma
üîê Mot de passe:  admin2025
üì± T√©l√©phone:     0667891234
üÜî User ID:       159
üìã Profil ID:     17
üéØ Sp√©cialit√©:    Super Administration
üìÖ Cr√©√© le:       25 juillet 2025 - 09:34:06
üî± Status:        SUPER ADMIN ACTIF ‚úÖ
```

**üîê Connexion rapide :**
```json
POST /api/login
{
    "email": "admin@epg.ma",
    "password": "admin2025"
}
```

---

## üõ†Ô∏è **√âTAPES DE CR√âATION D'UN SUPER ADMIN VIA TERMINAL**

### **M√©thode 1: Commande Artisan (Recommand√©e)**

#### 1Ô∏è‚É£ **Cr√©ation compl√®te d'un nouveau Super Admin**
```bash
# Syntaxe g√©n√©rale
php artisan admin:create-super [EMAIL] [NOM] [MOT_DE_PASSE]

# Exemple pratique
php artisan admin:create-super superadmin@epg.ma "Super Admin Principal" "MotDePasseSecurise2025"
```

**‚úÖ Cette commande fait automatiquement :**
- Cr√©e l'utilisateur avec `role = 'admin'`
- D√©finit `is_super_admin = true`
- G√©n√®re un profil admin associ√©
- Hash le mot de passe de fa√ßon s√©curis√©e
- V√©rifie l'unicit√© de l'email

#### 2Ô∏è‚É£ **V√©rifier la cr√©ation**
```bash
# Lister tous les Super Admins
php artisan tinker --execute="
    \$superAdmins = \App\Models\User::where('is_super_admin', true)->get();
    foreach(\$superAdmins as \$admin) {
        echo 'ID: ' . \$admin->id . ' - ' . \$admin->nom . ' (' . \$admin->email . ')' . PHP_EOL;
    }
"
```

### **M√©thode 2: Via Base de Donn√©es Directe**

#### 1Ô∏è‚É£ **Cr√©er l'utilisateur**
```sql
INSERT INTO users (nom, email, password, tel, role, is_super_admin, created_at, updated_at) 
VALUES (
    'Super Admin', 
    'superadmin@epg.ma', 
    '$2y$12$HashedPasswordHere', 
    '0123456789', 
    'admin', 
    true, 
    NOW(), 
    NOW()
);
```

#### 2Ô∏è‚É£ **Cr√©er le profil admin**
```sql
-- R√©cup√©rer l'ID de l'utilisateur cr√©√©
SET @user_id = LAST_INSERT_ID();

-- Cr√©er le profil
INSERT INTO admin_profiles (user_id, specialite, created_at, updated_at) 
VALUES (@user_id, 'Super Administration', NOW(), NOW());
```

### **M√©thode 3: Via Artisan Tinker**

#### 1Ô∏è‚É£ **Ouvrir Tinker**
```bash
php artisan tinker
```

#### 2Ô∏è‚É£ **Cr√©er le Super Admin**
```php
// Dans Tinker
use App\Models\User;
use App\Models\AdminProfile;
use Illuminate\Support\Facades\Hash;

// Cr√©er l'utilisateur
$user = User::create([
    'nom' => 'Super Admin Nouveau',
    'email' => 'nouveausuperadmin@epg.ma',
    'password' => Hash::make('MotDePasseSecurise2025'),
    'tel' => '0123456789',
    'role' => 'admin',
    'is_super_admin' => true
]);

// Cr√©er le profil
AdminProfile::create([
    'user_id' => $user->id,
    'specialite' => 'Super Administration'
]);

echo "Super Admin cr√©√© avec l'ID: " . $user->id;
```

---

## üîß **COMMANDES DE GESTION UTILES**

### **Promouvoir un admin existant en Super Admin**
```bash
# Via Tinker
php artisan tinker --execute="
    \$user = \App\Models\User::where('email', 'admin-normal@epg.ma')->first();
    if(\$user) {
        \$user->is_super_admin = true;
        \$user->save();
        echo 'Admin promu en Super Admin: ' . \$user->nom;
    } else {
        echo 'Utilisateur non trouv√©';
    }
"
```

### **R√©trograder un Super Admin**
```bash
# Via Tinker (ATTENTION : Ne pas se r√©trograder soi-m√™me !)
php artisan tinker --execute="
    \$user = \App\Models\User::where('email', 'admin-a-retrograder@epg.ma')->first();
    if(\$user && \$user->email !== 'admin@epg.ma') {
        \$user->is_super_admin = false;
        \$user->save();
        echo 'Super Admin r√©trograd√©: ' . \$user->nom;
    } else {
        echo 'Op√©ration non autoris√©e ou utilisateur non trouv√©';
    }
"
```

### **Changer le mot de passe d'un Super Admin**
```bash
# Via Tinker
php artisan tinker --execute="
    \$user = \App\Models\User::where('email', 'admin@epg.ma')->first();
    if(\$user) {
        \$user->password = Hash::make('NouveauMotDePasse2025');
        \$user->save();
        echo 'Mot de passe modifi√© pour: ' . \$user->nom;
    }
"
```

### **Lister tous les Super Admins**
```bash
php artisan tinker --execute="
    echo 'Liste des Super Admins:' . PHP_EOL;
    \$superAdmins = \App\Models\User::where('is_super_admin', true)->get();
    foreach(\$superAdmins as \$admin) {
        echo '- ID: ' . \$admin->id . ' | ' . \$admin->nom . ' (' . \$admin->email . ')' . PHP_EOL;
    }
    echo 'Total: ' . \$superAdmins->count() . ' Super Admins';
"
```

---

## üîê **R√àGLES DE S√âCURIT√â IMPORTANTES**

### **‚ùå INTERDICTIONS :**
1. **Ne jamais supprimer tous les Super Admins** - Garde toujours au moins un compte
2. **Ne jamais partager les identifiants** - Chaque Super Admin a son compte
3. **Ne pas utiliser des mots de passe faibles** - Minimum 8 caract√®res avec complexit√©
4. **Ne pas cr√©er de Super Admin via l'interface web** - Seulement via terminal s√©curis√©

### **‚úÖ BONNES PRATIQUES :**
1. **Changement r√©gulier des mots de passe** - Tous les 3-6 mois
2. **Limitation du nombre de Super Admins** - Maximum 2-3 comptes
3. **Documentation des actions** - Tracer qui fait quoi
4. **Sauvegarde des identifiants** - Dans un coffre-fort s√©curis√©

---

## üß™ **TESTS DE VALIDATION**

### **Test 1: Connexion Super Admin**
```bash
# PowerShell
$headers = @{ "Content-Type" = "application/json" }
$body = '{"email":"admin@epg.ma","password":"admin2025"}'
$response = Invoke-RestMethod -Uri "http://127.0.0.1:8000/api/login" -Method POST -Headers $headers -Body $body
echo "Token re√ßu: $($response.token -ne $null)"
```

### **Test 2: Acc√®s privil√©gi√©**
```bash
# Avec le token obtenu
$token = "VOTRE_TOKEN_ICI"
$headers = @{ "Authorization" = "Bearer $token"; "Content-Type" = "application/json" }
Invoke-RestMethod -Uri "http://127.0.0.1:8000/api/admin-profiles" -Method GET -Headers $headers
```

### **Test 3: V√©rification base de donn√©es**
```bash
php artisan tinker --execute="
    \$user = \App\Models\User::find(159);
    echo 'Super Admin Status: ' . (\$user->is_super_admin ? 'ACTIF' : 'INACTIF');
"
```

---

## üöÄ **ROUTES DE TEST SUPER ADMIN**

### **üìç URLs de Base**
```
Base URL: http://127.0.0.1:8000/api
Environment: D√©veloppement local
Server: Laravel artisan serve
```

### **üîê Authentification**

#### **POST /api/login - Connexion Super Admin**
```bash
# PowerShell
$headers = @{ "Content-Type" = "application/json" }
$body = '{"email":"admin@epg.ma","password":"admin2025"}'
$response = Invoke-RestMethod -Uri "http://127.0.0.1:8000/api/login" -Method POST -Headers $headers -Body $body
$superToken = $response.token
echo "Super Admin connect√© - Token: $superToken"
```

**R√©ponse attendue :**
```json
{
    "token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9...",
    "user": {
        "id": 159,
        "nom": "Fatine",
        "email": "admin@epg.ma",
        "role": "admin",
        "is_super_admin": true
    }
}
```

### **üëë Routes Super Admin Privil√©gi√©es**

#### **GET /api/admin-profiles - Liste tous les profils admin**
```bash
# PowerShell - Acc√®s autoris√© pour Super Admin
$token = "VOTRE_SUPER_ADMIN_TOKEN"
$headers = @{ "Authorization" = "Bearer $token"; "Content-Type" = "application/json" }
$result = Invoke-RestMethod -Uri "http://127.0.0.1:8000/api/admin-profiles" -Method GET -Headers $headers
echo "Nombre d'admins trouv√©s: $($result.Count)"
```

**‚úÖ R√©sultat attendu :** Liste compl√®te des profils admin  
**‚ùå Pour admin normal :** 403 Forbidden

#### **GET /api/admin-profiles/{id} - Voir profil admin sp√©cifique**
```bash
# PowerShell - Super Admin peut voir n'importe quel profil
$token = "VOTRE_SUPER_ADMIN_TOKEN"
$adminId = 184  # ID d'un admin normal
$headers = @{ "Authorization" = "Bearer $token"; "Content-Type" = "application/json" }
Invoke-RestMethod -Uri "http://127.0.0.1:8000/api/admin-profiles/$adminId" -Method GET -Headers $headers
```

**‚úÖ Super Admin :** Acc√®s √† tous les profils  
**‚ùå Admin normal :** Seulement son propre profil

#### **PUT /api/admin-profiles/{id} - Modifier profil admin**
```bash
# PowerShell - Super Admin peut modifier n'importe quel profil
$token = "VOTRE_SUPER_ADMIN_TOKEN"
$adminId = 184
$headers = @{ "Authorization" = "Bearer $token"; "Content-Type" = "application/json" }
$body = '{"specialite":"Administration modifi√©e"}'
Invoke-RestMethod -Uri "http://127.0.0.1:8000/api/admin-profiles/$adminId" -Method PUT -Headers $headers -Body $body
```

#### **DELETE /api/admin-profiles/{id} - Supprimer admin**
```bash
# PowerShell - Seul Super Admin peut supprimer
$token = "VOTRE_SUPER_ADMIN_TOKEN"
$adminId = 184  # Admin normal √† supprimer
$headers = @{ "Authorization" = "Bearer $token"; "Content-Type" = "application/json" }
Invoke-RestMethod -Uri "http://127.0.0.1:8000/api/admin-profiles/$adminId" -Method DELETE -Headers $headers
```

**üîí Protections :**
- ‚ùå Suppression d'autres Super Admins : 403 Forbidden
- ‚ùå Auto-suppression : 403 Forbidden
- ‚úÖ Suppression admin normal : 200 OK

### **üë• Routes de Gestion Utilisateurs**

#### **GET /api/teacher-profiles - Gestion formateurs**
```bash
# Super Admin peut voir tous les formateurs
$token = "VOTRE_SUPER_ADMIN_TOKEN"
$headers = @{ "Authorization" = "Bearer $token"; "Content-Type" = "application/json" }
Invoke-RestMethod -Uri "http://127.0.0.1:8000/api/teacher-profiles" -Method GET -Headers $headers
```

#### **GET /api/student-profiles - Gestion √©tudiants**
```bash
# Super Admin peut voir tous les √©tudiants
$token = "VOTRE_SUPER_ADMIN_TOKEN"
$headers = @{ "Authorization" = "Bearer $token"; "Content-Type" = "application/json" }
Invoke-RestMethod -Uri "http://127.0.0.1:8000/api/student-profiles" -Method GET -Headers $headers
```

### **üß™ Tests de S√©curit√© - Admin Normal vs Super Admin**

#### **Test 1: Admin normal tente d'acc√©der aux routes privil√©gi√©es**
```bash
# 1. Connexion admin normal
$headers = @{ "Content-Type" = "application/json" }
$body = '{"email":"admin-normal@epg.ma","password":"password123"}'
$response = Invoke-RestMethod -Uri "http://127.0.0.1:8000/api/login" -Method POST -Headers $headers -Body $body
$normalToken = $response.token

# 2. Tentative d'acc√®s (doit √©chouer)
$headers = @{ "Authorization" = "Bearer $normalToken"; "Content-Type" = "application/json" }
try {
    Invoke-RestMethod -Uri "http://127.0.0.1:8000/api/admin-profiles" -Method GET -Headers $headers
    echo "‚ùå S√âCURIT√â COMPROMISE !"
} catch {
    echo "‚úÖ S√âCURIT√â OK - Acc√®s refus√©: $($_.Exception.Message)"
}
```

#### **Test 2: Protection auto-suppression Super Admin**
```bash
# Super Admin tente de se supprimer (doit √©chouer)
$token = "VOTRE_SUPER_ADMIN_TOKEN"
$superAdminId = 159  # Son propre ID
$headers = @{ "Authorization" = "Bearer $token"; "Content-Type" = "application/json" }
try {
    Invoke-RestMethod -Uri "http://127.0.0.1:8000/api/admin-profiles/$superAdminId" -Method DELETE -Headers $headers
    echo "‚ùå PROTECTION √âCHOU√âE !"
} catch {
    echo "‚úÖ PROTECTION OK - Auto-suppression bloqu√©e: $($_.Exception.Message)"
}
```

### **üìä Matrice de Tests Complets**

| **Route** | **Super Admin** | **Admin Normal** | **Expected Status** |
|-----------|-----------------|------------------|---------------------|
| `GET /api/admin-profiles` | ‚úÖ 200 OK | ‚ùå 403 Forbidden | ‚úÖ |
| `GET /api/admin-profiles/{id}` (autre) | ‚úÖ 200 OK | ‚ùå 403 Forbidden | ‚úÖ |
| `GET /api/admin-profiles/{id}` (soi) | ‚úÖ 200 OK | ‚úÖ 200 OK | ‚úÖ |
| `PUT /api/admin-profiles/{id}` (autre) | ‚úÖ 200 OK | ‚ùå 403 Forbidden | ‚úÖ |
| `DELETE /api/admin-profiles/{id}` (normal) | ‚úÖ 200 OK | ‚ùå 403 Forbidden | ‚úÖ |
| `DELETE /api/admin-profiles/{id}` (super) | ‚ùå 403 Forbidden | ‚ùå 403 Forbidden | ‚úÖ |
| `DELETE /api/admin-profiles/{id}` (soi) | ‚ùå 403 Forbidden | ‚ùå 403 Forbidden | ‚úÖ |

### **üîÑ Script de Test Automatis√©**

#### **test_super_admin.ps1**
```powershell
# Script PowerShell pour tester toutes les fonctionnalit√©s Super Admin
param(
    [string]$BaseUrl = "http://127.0.0.1:8000/api",
    [string]$SuperAdminEmail = "admin@epg.ma",
    [string]$SuperAdminPassword = "admin2025"
)

Write-Host "üî± D√âBUT DES TESTS SUPER ADMIN" -ForegroundColor Cyan

# 1. Connexion Super Admin
Write-Host "`n1Ô∏è‚É£ Test de connexion Super Admin..." -ForegroundColor Yellow
$headers = @{ "Content-Type" = "application/json" }
$body = @{
    email = $SuperAdminEmail
    password = $SuperAdminPassword
} | ConvertTo-Json

try {
    $response = Invoke-RestMethod -Uri "$BaseUrl/login" -Method POST -Headers $headers -Body $body
    $superToken = $response.token
    Write-Host "‚úÖ Connexion r√©ussie - Token obtenu" -ForegroundColor Green
} catch {
    Write-Host "‚ùå √âchec de connexion: $($_.Exception.Message)" -ForegroundColor Red
    exit 1
}

# 2. Test acc√®s liste admin
Write-Host "`n2Ô∏è‚É£ Test acc√®s liste des admins..." -ForegroundColor Yellow
$authHeaders = @{ 
    "Authorization" = "Bearer $superToken"
    "Content-Type" = "application/json" 
}

try {
    $admins = Invoke-RestMethod -Uri "$BaseUrl/admin-profiles" -Method GET -Headers $authHeaders
    Write-Host "‚úÖ Acc√®s autoris√© - $($admins.Count) admin(s) trouv√©(s)" -ForegroundColor Green
} catch {
    Write-Host "‚ùå Acc√®s refus√©: $($_.Exception.Message)" -ForegroundColor Red
}

# 3. Test protection auto-suppression
Write-Host "`n3Ô∏è‚É£ Test protection auto-suppression..." -ForegroundColor Yellow
try {
    Invoke-RestMethod -Uri "$BaseUrl/admin-profiles/159" -Method DELETE -Headers $authHeaders
    Write-Host "‚ùå ALERTE: Auto-suppression possible !" -ForegroundColor Red
} catch {
    Write-Host "‚úÖ Protection OK - Auto-suppression bloqu√©e" -ForegroundColor Green
}

Write-Host "`nüéâ TESTS SUPER ADMIN TERMIN√âS" -ForegroundColor Cyan
```

**Utilisation :**
```bash
# Ex√©cuter le script de test
powershell -ExecutionPolicy Bypass -File test_super_admin.ps1
```

---

## üìû **CONTACT D'URGENCE**

En cas de perte d'acc√®s au Super Admin :

### **R√©cup√©ration d'urgence :**
```bash
# Cr√©er un nouveau Super Admin d'urgence
php artisan admin:create-super urgence@epg.ma "Admin Urgence" "UrgenceSecure2025"

# Ou r√©activer un compte existant
php artisan tinker --execute="
    \$user = \App\Models\User::where('email', 'backup@epg.ma')->first();
    if(\$user) {
        \$user->is_super_admin = true;
        \$user->save();
        echo 'Compte de secours activ√©';
    }
"
```

---

## üìö **HISTORIQUE DES MODIFICATIONS**

| **Date** | **Action** | **D√©tails** |
|----------|------------|-------------|
| **25/07/2025** | Cr√©ation Super Admin initial | Email: admin@epg.ma, Nom: Fatine |
| **25/07/2025** | Ajout profil admin manquant | Profil ID: 17, Sp√©cialit√©: Super Administration |
| **25/07/2025** | Documentation compl√®te | Guide cr√©ation et identifiants |

---

**‚ö†Ô∏è IMPORTANT : Gardez ce fichier dans un endroit s√©curis√© et ne le partagez jamais publiquement !** üîí

**üìù Derni√®re mise √† jour : 25 juillet 2025** ‚ú®
